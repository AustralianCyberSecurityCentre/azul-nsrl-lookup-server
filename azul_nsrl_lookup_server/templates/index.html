{% extends 'base.html' %}

{% block content %}
<div class="px-4 py-5 text-center">
    <div class="py-5">
        <div class="col-lg-6 mx-auto">
            <p class="fs-5 mb-4">This is a RESTful interface to a database of the NSRL catalogue.</p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <form class="d-block" role="search" method="POST" action="{{ url_for('results') }}">
                    <div class="row g-3 align-items-center">
                        <div class="col-lg-10">
                            <input class="form-control me-2" type="search" placeholder="SHA256, SHA1, MD5..."
                                aria-label="Search" id="digest" name="digest">
                        </div>
                        <div class="col-lg-2">
                            <button type="submit" class="btn btn-outline-info btn-lg px-4 me-sm-3 fw-bold">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-search" viewBox="0 0 16 16">
                                    <path
                                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="row g-3 align-items-center">
                        <div class="col-lg-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="detailed" id="detailed">
                                <label class="form-check-label" for="detailed">detailed</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {% if err %}
        <div class="col-lg-6 mx-auto">
            <p class="fs-5 mb-4">
                {% if err.status_code == 404 %}
                Not Found
                {% else %}
                Error: {{ err.detail }}
                {% endif %}
            </p>
        </div>
        {% endif %}

        {% if results %}
        <div class="col-lg-5 mx-auto text-start">
            <table class="table table-dark table-hover table-borderless mt-5">
                <tbody>
                    <tr>
                        <th scope="col">md5</th>
                        <td>{{ results[0].md5 }}</td>
                    </tr>
                    <tr>
                        <th scope="col">sha1</th>
                        <td>{{ results[0].sha1 }}</td>
                    </tr>
                    <tr>
                        <th scope="col">sha256</th>
                        <td>{{ results[0].sha256 }}</td>
                    </tr>
                    {% if detailed %}
                    <tr>
                        <th scope="col">File Size</th>
                        <td>{{ results[0].file_size}}</td>
                    </tr>
                    <tr>
                        <th scope="col">Total Packages</th>
                        <td>{{ pkg_stats["num_packages"] }}</td>
                    </tr>
                    <tr>
                        <th scope="col">Unique Packages</th>
                        <td>{{ pkg_stats["uniq_packages"] }}</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        {% if detailed %}
        <div class="text-start mx-auto">
            <h4>Sample Packages:</h4>
            <table class="table table-dark table-hover table-striped mt-5">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Package</th>
                        <th>Package Version</th>
                        <th>Package Language</th>
                        <th>Package Application Type</th>
                        <th>Package Manufacturer</th>
                        <th>Operating System</th>
                        <th>Operating System Version</th>
                    </tr>
                </thead>
                <tbody>
                {% for details in results %}
                <tr>
                    <td>{{ details.file_name }}</td>
                    <td>{{ details.package_name }}</td>
                    <td>{{ details.package_version }}</td>
                    <td>{{ details.package_language }}</td>
                    <td>{{ details.package_app_type }}</td>
                    <td>{{ details.package_manufacturer }}</td>
                    <td>{{ details.operating_system_name }}</td>
                    <td>{{ details.operating_system_version }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% endif %}

    </div>
</div>
{% endblock content %}
